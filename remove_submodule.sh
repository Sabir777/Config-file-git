#!/bin/bash

if [ -z "$1" ]; then
    echo "‚ùå –£–∫–∞–∂–∏—Ç–µ –∏–º—è —Å–∞–±–º–æ–¥—É–ª—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è."
    echo "–ü—Ä–∏–º–µ—Ä: $0 tmux_config"
    exit 1
fi

MODULE_NAME="$1"

echo "üßπ –£–¥–∞–ª–µ–Ω–∏–µ —Å–∞–±–º–æ–¥—É–ª—è: $MODULE_NAME"

# –î–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∞–±–º–æ–¥—É–ª—è
git submodule deinit -f "$MODULE_NAME"

# –î–æ–±–∞–≤–ª—è—é –≤ —Å—Ç—ç–π–¥–∂–∏–Ω–≥ —á—Ç–æ–±—ã –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ –Ω–µ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞
git add .gitmodules

# –£–¥–∞–ª—è–µ–º —Å–∞–±–º–æ–¥—É–ª—å –∏–∑ –∏–Ω–¥–µ–∫—Å–∞
if git rm --cached "$MODULE_NAME"; then
    echo "üì¶ –°–∞–±–º–æ–¥—É–ª—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω –∏–∑ –∏–Ω–¥–µ–∫—Å–∞: $MODULE_NAME"
else
    echo "‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –∏–Ω–¥–µ–∫—Å–∞. –ü—Ä–æ–≤–µ—Ä—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ git."
    exit 1
fi

# –£–¥–∞–ª—è–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å–∞–±–º–æ–¥—É–ª—è
rm -rf "$MODULE_NAME"

# –£–¥–∞–ª—è–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–∞–±–º–æ–¥—É–ª—è
rm -rf ".git/modules/$MODULE_NAME"

# –û—Ç–∫—Ä—ã–≤–∞–µ–º .gitmodules –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –ø–æ–∏—Å–∫–æ–º –ø–æ –∏–º–µ–Ω–∏ —Å–∞–±–º–æ–¥—É–ª—è
if [ -f .gitmodules ]; then
    echo "üìÇ –û—Ç–∫—Ä—ã–≤–∞–µ–º .gitmodules –≤ vim..."
    sleep 1
    vim +"/$MODULE_NAME" .gitmodules
fi

echo "‚úÖ –ì–æ—Ç–æ–≤–æ. –ù–µ –∑–∞–±—É–¥—å —Å–¥–µ–ª–∞—Ç—å –∫–æ–º–º–∏—Ç –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏."
